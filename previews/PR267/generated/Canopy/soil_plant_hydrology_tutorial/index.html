<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Coupled Canopy and Soil Hydrology · ClimaLSM.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">ClimaLSM.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">ClimaLSM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/ClimaLSM/">ClimaLSM</a></li><li><a class="tocitem" href="../../../APIs/Regridder/">Parameter Dataset Tools</a></li><li><a class="tocitem" href="../../../APIs/shared_utilities/">Shared Utilities</a></li><li><input class="collapse-toggle" id="menuitem-2-1-4" type="checkbox"/><label class="tocitem" for="menuitem-2-1-4"><span class="docs-label">Soil</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/Soil/">Soil Energy and Hydrology</a></li><li><a class="tocitem" href="../../../APIs/SoilBiogeochemistry/">Soil Biogeochemistry</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-1-5" type="checkbox"/><label class="tocitem" for="menuitem-2-1-5"><span class="docs-label">Canopy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../APIs/canopy/Canopy/">Canopy Models</a></li><li><a class="tocitem" href="../../../APIs/canopy/PlantHydraulics/">Plant Hydraulics</a></li><li><a class="tocitem" href="../../../APIs/canopy/Photosynthesis/">Canopy Photosynthesis</a></li><li><a class="tocitem" href="../../../APIs/canopy/RadiativeTransfer/">Canopy RT</a></li><li><a class="tocitem" href="../../../APIs/canopy/StomatalConductance/">Canopy Stomatal Conductance</a></li></ul></li><li><a class="tocitem" href="../../../APIs/SurfaceWater/">Surface Water Models</a></li><li><a class="tocitem" href="../../../APIs/Bucket/">Bucket Model</a></li><li><a class="tocitem" href="../../../APIs/Snow/">Snow Model</a></li></ul></li></ul></li><li><a class="tocitem" href="../../../Contributing/">Contribution guide</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">For model developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Usage/model_tutorial/">Using AbstractModel functionality</a></li><li><a class="tocitem" href="../../Usage/LSM_single_column_tutorial/">Intro to multi-component models</a></li><li><a class="tocitem" href="../../Usage/domain_tutorial/">Intro to ClimaLSM Domains</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox" checked/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Running simulations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-2-1" type="checkbox"/><label class="tocitem" for="menuitem-4-2-1"><span class="docs-label">Soil modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Soil/richards_equation/">Richards Equation</a></li><li><a class="tocitem" href="../../Soil/soil_energy_hydrology/">Energy and Hydrology</a></li><li><a class="tocitem" href="../../Soil/freezing_front/">Phase Changes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-4-2-2"><span class="docs-label">Canopy modeling</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../canopy_tutorial/">Standalone Canopy</a></li><li class="is-active"><a class="tocitem" href>Coupled Canopy and Soil Hydrology</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Preliminary-Setup"><span>Preliminary Setup</span></a></li><li class="toplevel"><a class="tocitem" href="#Setup-the-Coupled-Canopy-and-Soil-Physics-Model"><span>Setup the Coupled Canopy and Soil Physics Model</span></a></li><li class="toplevel"><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2-3" type="checkbox"/><label class="tocitem" for="menuitem-4-2-3"><span class="docs-label">Bucket LSM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Bucket/bucket_tutorial/">Introduction to the Land Bucket Model</a></li><li><a class="tocitem" href="../../Bucket/coupled_bucket/">Setting up a Coupled Simulation</a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../../../folderstructure/">Repository structure</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Running simulations</a></li><li><a class="is-disabled">Canopy modeling</a></li><li class="is-active"><a href>Coupled Canopy and Soil Hydrology</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Coupled Canopy and Soil Hydrology</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimaLSM.jl/../../../.." title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Coupling-the-CliMA-Canopy-and-Soil-Hydraulics-Models"><a class="docs-heading-anchor" href="#Coupling-the-CliMA-Canopy-and-Soil-Hydraulics-Models">Coupling the CliMA Canopy and Soil Hydraulics Models</a><a id="Coupling-the-CliMA-Canopy-and-Soil-Hydraulics-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-the-CliMA-Canopy-and-Soil-Hydraulics-Models" title="Permalink"></a></h1><p>In the <code>previous tutorial</code>, we demonstrated how to run the canopy model in standalone mode using prescribed values for the inputs of soil hydraulics into the canopy hydraulics model. However, ClimaLSM has the built-in capacity to couple the canopy model with a soil physics model and timestep the two simulations together to model a canopy-soil hydrology system. This tutorial demonstrates how to setup and run a coupled hydrology simulation, again using initial conditions, atmospheric and radiative flux conditions, and canopy properties observed at the US-MOz flux tower, a flux tower located within an oak-hickory forest in Ozark, Missouri, USA. See <a href="https://doi.org/10.5194/gmd-14-6741-2021">Wang et al. 2021</a> for details on the site and parameters.</p><p>In ClimaLSM, the coupling of the canopy and Richard&#39;s models is done by pairing the root extraction of the canopy hydraulics model, which acts as a boundary flux for the plant system, with a source term for root extraction in the Richard&#39;s model, so that the flux of water from the soil into the roots is equal and factored into both models. This pairing is done automatically in the constructor for a <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/ClimaLSM/#LSM-Model-Types-and-methods"><code>SoilPlantHydrologyModel</code></a> so that a user needs only specify the necessary arguments for each of the component models, and the two models will automatically be paired into a coupled hydrology model.</p><h1 id="Preliminary-Setup"><a class="docs-heading-anchor" href="#Preliminary-Setup">Preliminary Setup</a><a id="Preliminary-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Preliminary-Setup" title="Permalink"></a></h1><p>Load External Packages:</p><pre><code class="language-julia hljs">import OrdinaryDiffEq as ODE
using Plots
using Statistics
using Dates
using Insolation</code></pre><p>Load CliMA Packages and ClimaLSM Modules:</p><pre><code class="language-julia hljs">using ClimaCore
import CLIMAParameters as CP
import ClimaTimeSteppers as CTS
using ClimaLSM
using ClimaLSM.Domains: LSMSingleColumnDomain
using ClimaLSM.Soil
using ClimaLSM.Canopy
using ClimaLSM.Canopy.PlantHydraulics
import ClimaLSM
import ClimaLSM.Parameters as LSMP
include(joinpath(pkgdir(ClimaLSM), &quot;parameters&quot;, &quot;create_parameters.jl&quot;));</code></pre><p>Define the floating point precision desired (64 or 32 bit), and get the parameter set holding constants used across CliMA Models:</p><pre><code class="language-julia hljs">const FT = Float64;
earth_param_set = create_lsm_parameters(FT);</code></pre><h1 id="Setup-the-Coupled-Canopy-and-Soil-Physics-Model"><a class="docs-heading-anchor" href="#Setup-the-Coupled-Canopy-and-Soil-Physics-Model">Setup the Coupled Canopy and Soil Physics Model</a><a id="Setup-the-Coupled-Canopy-and-Soil-Physics-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-the-Coupled-Canopy-and-Soil-Physics-Model" title="Permalink"></a></h1><p>We want to simulate the canopy-soil system together, so the model type <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/ClimaLSM/#LSM-Model-Types-and-methods"><code>SoilPlantHydrologyModel</code></a> is chosen. From the linked documentation, we see that we need to provide the soil model type and arguments as well as the canopy model component types, component arguments, and the canopy model arguments, so we first need to initialize all of these.</p><p>Setup the domain for the model:</p><pre><code class="language-julia hljs">nelements = 10
zmin = FT(-2)
zmax = FT(0)
land_domain =
    LSMSingleColumnDomain(; zlim = (zmin, zmax), nelements = nelements);</code></pre><p>For our soil model, we will choose a <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/Soil/#Soil-Models-2"><code>RichardsModel</code></a> and set up all the necessary arguments. See the <a href="https://clima.github.io/ClimaLSM.jl/dev/generated/Soil/richards_equation/">tutorial</a> on Richard&#39;s Model for a more detailed explanation of the soil model.</p><pre><code class="language-julia hljs">soil_ν = FT(0.55)
soil_K_sat = FT(4e-7)
soil_S_s = FT(1e-3)
soil_vg_n = FT(2.6257)
soil_vg_α = FT(1.368)
θ_r = FT(0.067)

soil_domain = land_domain.subsurface
soil_ps = Soil.RichardsParameters{FT, vanGenuchten{FT}}(
    soil_ν,
    vanGenuchten(; α = soil_vg_α, n = soil_vg_n),
    soil_K_sat,
    soil_S_s,
    θ_r,
)

soil_args = (domain = soil_domain, parameters = soil_ps)
soil_model_type = Soil.RichardsModel{FT};</code></pre><p>Next we need to set up the <a href="https://clima.github.io/ClimaLSM.jl/dev/APIs/canopy/Canopy/#Canopy-Model-Structs"><code>CanopyModel</code></a>. For more details on the specifics of this model see the previous tutorial.</p><p>Begin by declaring the component types of the canopy model. Unlike in the previous tutorial, collect the arguments to each component into tuples and do not instantiate the component models yet. The constructor for the SoilPlantHydrologyModel will use these arguments and internally instatiate the component CanopyModel and RichardsModel instances. This is done so that the constructor may enforce consistency constraints between the two models, and this must be done internally from the constructor.</p><pre><code class="language-julia hljs">canopy_component_types = (;
    radiative_transfer = Canopy.BeerLambertModel{FT},
    photosynthesis = Canopy.FarquharModel{FT},
    conductance = Canopy.MedlynConductanceModel{FT},
    hydraulics = Canopy.PlantHydraulicsModel{FT},
);</code></pre><p>Then provide arguments to the canopy radiative transfer, stomatal conductance, and photosynthesis models as was done in the previous tutorial.</p><pre><code class="language-julia hljs">radiative_transfer_args = (;
    parameters = BeerLambertParameters{FT}(;
        Ω = FT(0.69),
        ld = FT(0.5),
        ρ_leaf = FT(0.1),
        λ_γ = FT(5e-7),
    )
)

conductance_args = (;
    parameters = MedlynConductanceParameters{FT}(;
        g1 = FT(141),
        Drel = FT(1.6),
        g0 = FT(1e-4),
    )
)

photosynthesis_args = (;
    parameters = FarquharParameters{FT}(
        Canopy.C3();
        oi = FT(0.209),
        ϕ = FT(0.6),
        θj = FT(0.9),
        f = FT(0.015),
        sc = FT(5e-6),
        pc = FT(-2e5),
        Vcmax25 = FT(5e-5),
        Γstar25 = FT(4.275e-5),
        Kc25 = FT(4.049e-4),
        Ko25 = FT(0.2874),
        To = FT(298.15),
        ΔHkc = FT(79430),
        ΔHko = FT(36380),
        ΔHVcmax = FT(58520),
        ΔHΓstar = FT(37830),
        ΔHJmax = FT(43540),
        ΔHRd = FT(46390),
    )
);</code></pre><p>For the plant hydraulics model, we now will not provide prescribed root extraction since the soil pressure will now be simulated by the soil physics model.</p><pre><code class="language-julia hljs">f_root_to_shoot = FT(3.5)
SAI = FT(0.00242)
LAI = FT(4.2)
K_sat_plant = 1.8e-8
RAI = (SAI + LAI) * f_root_to_shoot

area_index = (root = RAI, stem = SAI, leaf = LAI)

function root_distribution(z::T; rooting_depth = FT(1.0)) where {T}
    return T(1.0 / rooting_depth) * exp(z / T(rooting_depth)) # 1/m
end

ψ63 = FT(-4 / 0.0098)
Weibull_param = FT(4)
a = FT(0.05 * 0.0098)

conductivity_model =
    PlantHydraulics.Weibull{FT}(K_sat_plant, ψ63, Weibull_param)

retention_model = PlantHydraulics.LinearRetentionCurve{FT}(a)

plant_ν = FT(0.7)
plant_S_s = FT(1e-2 * 0.0098)

plant_hydraulics_ps = PlantHydraulics.PlantHydraulicsParameters(;
    area_index = area_index,
    ν = plant_ν,
    S_s = plant_S_s,
    root_distribution = root_distribution,
    conductivity_model = conductivity_model,
    retention_model = retention_model,
)

n_stem = Int64(1)
n_leaf = Int64(1)
h_stem = FT(9)
h_leaf = FT(9.5)
compartment_midpoints = [h_stem / 2, h_stem + h_leaf / 2]
compartment_surfaces = [zmax, h_stem, h_stem + h_leaf]

plant_hydraulics_args = (
    parameters = plant_hydraulics_ps,
    n_stem = n_stem,
    n_leaf = n_leaf,
    compartment_midpoints = compartment_midpoints,
    compartment_surfaces = compartment_surfaces,
);</code></pre><p>We may now collect all of the canopy component argument tuples into one arguments tuple for the canopy component models.</p><pre><code class="language-julia hljs">canopy_component_args = (;
    radiative_transfer = radiative_transfer_args,
    photosynthesis = photosynthesis_args,
    conductance = conductance_args,
    hydraulics = plant_hydraulics_args,
);</code></pre><p>We also need to provide the shared parameter struct to the canopy as usual and specify the domain for the canopy.</p><pre><code class="language-julia hljs">z0_m = FT(2)
z0_b = FT(0.2)

shared_params = SharedCanopyParameters{FT, typeof(earth_param_set)}(
    LAI,
    h_stem + h_leaf,
    z0_m,
    z0_b,
    earth_param_set,
)

canopy_model_args = (; parameters = shared_params, domain = land_domain.surface);</code></pre><ul><li>We will be using prescribed atmospheric and radiative drivers from the US-MOz tower, which we read in here. We are using prescribed atmospheric and radiative flux conditions, but it is also possible to couple the simulation with atmospheric and radiative flux models.</li></ul><pre><code class="language-julia hljs">include(
    joinpath(
        pkgdir(ClimaLSM),
        &quot;experiments/integrated/ozark/ozark_met_drivers_FLUXNET.jl&quot;,
    ),
);</code></pre><p>We may now instantiate the integrated plant hydraulics and soil model. The Default diagnostics is transpiration. Here we will work with prescribed atmospheric and radiative flux conditions from the observations at the Ozark site as was done in the previous tutorial.</p><pre><code class="language-julia hljs">land_input = (
    transpiration = DiagnosticTranspiration{Float64}(),
    atmos = atmos,
    radiation = radiation,
)

land = SoilPlantHydrologyModel{FT}(;
    land_args = land_input,
    soil_model_type = soil_model_type,
    soil_args = soil_args,
    canopy_component_types = canopy_component_types,
    canopy_component_args = canopy_component_args,
    canopy_model_args = canopy_model_args,
);</code></pre><p>Now we can initialize the state vectors and model coordinates, and initialize the explicit/implicit tendencies as usual. The Richard&#39;s equation time stepping is done implicitly, while the canopy model may be explicitly stepped, so we use an IMEX (implicit-explicit) scheme for the combined model.</p><pre><code class="language-julia hljs">Y, p, coords = initialize(land)
exp_tendency! = make_exp_tendency(land)
imp_tendency! = make_imp_tendency(land);</code></pre><p>We need to provide initial conditions for the soil and canopy hydraulics models:</p><pre><code class="language-julia hljs">Y.soil.ϑ_l = FT(0.4)
ψ_stem_0 = FT(-1e5 / 9800)
ψ_leaf_0 = FT(-2e5 / 9800)

S_l_ini =
    inverse_water_retention_curve.(
        retention_model,
        [ψ_stem_0, ψ_leaf_0],
        plant_ν,
        plant_S_s,
    )

for i in 1:2
    Y.canopy.hydraulics.ϑ_l[i] .=
        augmented_liquid_fraction.(plant_ν, S_l_ini[i])
end;</code></pre><p>Now initialize the auxiliary variables for the combined soil and plant model.</p><pre><code class="language-julia hljs">t0 = FT(0)
update_aux! = make_update_aux(land)
update_aux!(p, Y, t0);</code></pre><p>Select the timestepper and solvers needed for the specific problem, and setup the jacobian for the soil model. For more details on the soil jacobian setup see the tutorial on using a Richard&#39;s Model. Specify the time range and dt value over which to perform the simulation.</p><pre><code class="language-julia hljs">update_jacobian! = make_update_jacobian(land.soil)

N_days = 365
tf = t0 + FT(3600 * 24 * N_days)
dt = FT(225)
n = 16
saveat = Array(t0:(n * dt):tf)
timestepper = CTS.ARS222()
norm_condition = CTS.MaximumError(FT(1e-8))
conv_checker = CTS.ConvergenceChecker(; norm_condition)
max_iterations = 20

ode_algo = CTS.IMEXAlgorithm(
    timestepper,
    CTS.NewtonsMethod(
        max_iters = max_iterations,
        update_j = CTS.UpdateEvery(CTS.NewNewtonIteration),
        convergence_checker = conv_checker,
    ),
)

W = RichardsTridiagonalW(Y)
jac_kwargs = (; jac_prototype = W, Wfact = update_jacobian!);</code></pre><p>And now perform the simulation as always.</p><pre><code class="language-julia hljs">sv = (;
    t = Array{FT}(undef, length(saveat)),
    saveval = Array{ClimaCore.Fields.FieldVector}(undef, length(saveat)),
)
cb = ClimaLSM.NonInterpSavingCallback(sv, saveat)

prob = ODE.ODEProblem(
    CTS.ClimaODEFunction(
        T_exp! = exp_tendency!,
        T_imp! = ODE.ODEFunction(imp_tendency!; jac_kwargs...),
        dss! = ClimaLSM.dss!,
    ),
    Y,
    (t0, tf),
    p,
)
sol = ODE.solve(
    prob,
    ode_algo;
    dt = dt,
    callback = cb,
    adaptive = false,
    saveat = saveat,
);</code></pre><h1 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h1><p>Now that we have both a soil and canopy model incorporated together, we will show how to plot some model data demonstrating the time series produced from each of these models. As before, we may plot the GPP of the system as well as transpiration showing fluxes in the canopy.</p><pre><code class="language-julia hljs">daily = sol.t ./ 3600 ./ 24
model_GPP = [
    parent(sv.saveval[k].canopy.photosynthesis.GPP)[1] for
    k in 1:length(sv.saveval)
]

plt1 = Plots.plot(size = (600, 700));
Plots.plot!(
    plt1,
    daily,
    model_GPP .* 1e6,
    label = &quot;Model&quot;,
    xlim = [minimum(daily), maximum(daily)],
    xlabel = &quot;days&quot;,
    ylabel = &quot;GPP [μmol/mol]&quot;,
);</code></pre><p>Transpiration plot:</p><pre><code class="language-julia hljs">T = [
    parent(sv.saveval[k].canopy.conductance.transpiration)[1] for
    k in 1:length(sv.saveval)
]
T = T .* (1e3 * 24 * 3600)

plt2 = Plots.plot(size = (500, 700));
Plots.plot!(
    plt2,
    daily,
    T,
    label = &quot;Model&quot;,
    xlim = [minimum(daily), maximum(daily)],
    xlabel = &quot;days&quot;,
    ylabel = &quot;Vapor Flux [mm/day]&quot;,
);</code></pre><p>Show the two plots together:</p><pre><code class="language-julia hljs">Plots.plot(plt1, plt2, layout = (2, 1));</code></pre><p>Save the output:</p><pre><code class="language-julia hljs">savefig(&quot;ozark_canopy_flux_test.png&quot;);</code></pre><p><img src="../ozark_canopy_flux_test.png" alt/></p><p>Now, we will plot the augmented volumetric liquid water fraction at different depths in the soil over the course of the simulation.</p><pre><code class="language-julia hljs">plt1 = Plots.plot(size = (500, 700));
ϑ_l_10 = [parent(sol.u[k].soil.ϑ_l)[end] for k in 1:1:length(sol.t)]
plt1 = Plots.plot(
    daily,
    ϑ_l_10,
    label = &quot;10 cm&quot;,
    xlabel = &quot;Days&quot;,
    ylabel = &quot;SWC [m/m]&quot;,
    xlim = [minimum(daily), maximum(daily)],
    size = (500, 700),
    margins = 10Plots.mm,
    color = &quot;blue&quot;,
);

plot!(
    plt1,
    daily,
    [parent(sol.u[k].soil.ϑ_l)[end - 1] for k in 1:1:length(sol.t)],
    label = &quot;20cm&quot;,
    color = &quot;red&quot;,
);

plot!(
    plt1,
    daily,
    [parent(sol.u[k].soil.ϑ_l)[end - 2] for k in 1:1:length(sol.t)],
    label = &quot;30cm&quot;,
    color = &quot;purple&quot;,
);</code></pre><p>Save the output:</p><pre><code class="language-julia hljs">savefig(&quot;ozark_soil_test.png&quot;);</code></pre><p><img src="../ozark_soil_test.png" alt/></p><p>And now to demonstrate the coupling of the soil and canopy models we will plot the water fluxes from the soil up into the plant hydraulic system:</p><pre><code class="language-julia hljs">root_stem_flux = [
    sum(sv.saveval[k].root_extraction) .* (1e3 * 3600 * 24) for
    k in 1:length(sol.t)
]
plt1 = Plots.plot(
    daily,
    root_stem_flux,
    label = &quot;soil-root-stem water flux&quot;,
    ylabel = &quot;Water flux[mm/day]&quot;,
    xlim = [minimum(daily), maximum(daily)],
    size = (500, 700),
    margins = 10Plots.mm,
);</code></pre><p>And save the output</p><pre><code class="language-julia hljs">savefig(&quot;ozark_soil_plant_flux.png&quot;);</code></pre><p><img src="../ozark_soil_plant_flux.png" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../canopy_tutorial/">« Standalone Canopy</a><a class="docs-footer-nextpage" href="../../Bucket/bucket_tutorial/">Introduction to the Land Bucket Model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 18 July 2023 16:37">Tuesday 18 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
